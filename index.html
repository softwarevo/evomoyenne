<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#121212">
	<meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Calcule ta moyenne g√©n√©rale facilement avec evoMoyenne. Synchronise tes notes EcoleDirecte, simule tes r√©sultats avec les notes fant√¥mes et visualise ton √©volution.">
    <meta name="apple-mobile-web-app-title" content="evoMoyenne">
    <link rel="apple-touch-icon" href="assets/logos/logo-touch.png">
    <title>evoMoyenne</title>
	<script type="application/ld+json">
    {
 	 "@context": "https://schema.org",
 	 "@type": "WebApplication",
  	"name": "evoMoyenne",
	  "alternateName": "Evo Moyenne",
 	 "description": "Calcule ta moyenne scolaire facilement, simule des notes et synchronise ton compte EcoleDirecte. L'outil indispensable pour les √©l√®ves.",
 	 "url": "https://evomoyenne.qzz.io",
	  "applicationCategory": "EducationApplication",
 	 "operatingSystem": "All",
	  "offers": {
 	   "@type": "Offer",
  	  "price": "0",
 	   "priceCurrency": "EUR"
 	 },
 	 "featureList": [
  	  "Calcul de moyenne g√©n√©rale",
  	  "Notes fant√¥mes (simulation)",
  	  "Synchronisation EcoleDirecte",
  	  "Graphique d'√©volution",
	  "Suivi des moyennes",
	  "Moyenne EcoleDirecte",
	  "EcoleDirecte"
	  ]
	}
	</script>

	<!-- Manifest PWA -->
    <link rel="manifest" href="manifest.webmanifest">

	<!--Font and icons-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

	<!--CSS-->
    <link rel="stylesheet" href="assets/css/style.css">

</head>
<body data-theme="dark">
    <div class="app-container">
        <header class="top-bar">
            <div class="logo-container">
                <img id="logo-img" src="/assets/logos/logo-b.png" alt="Logo" loading="eager" width="32" height="32">
                <span class="logo-text">evoMoyenne</span>
				<span class="version-badge" id="version-badge" style="cursor: pointer;">v1.1</span>
            </div>
			
            <div class="top-actions">
                <div class="offline-badge" id="offline-badge">
                    <span class="material-symbols-rounded">cloud_off</span>
                    Hors-ligne
                </div>
                <div class="profile-wrapper">
                    <button class="profile-btn" id="profile-trigger">
                        <div class="profile-avatar">
                            <span class="material-symbols-rounded">person</span>
                        </div>
                        <span class="profile-name">Pr√©nom Nom</span>
                    </button>

                    <div class="login-tip hidden" id="login-tip">
                        <b>Connecte-toi</b>
                        Tu dois te connecter √† ton compte EcoleDirecte pour utiliser evoMoyenne.
                    </div>

                    <div class="dropdown-menu" id="profile-dropdown">
                        <button class="dropdown-item" id="menu-theme-toggle">
                            <span class="material-symbols-rounded">dark_mode</span>
                            <span id="theme-label">Mode Clair</span>
                        </button>
                        <button class="dropdown-item">
                            <span class="material-symbols-rounded">info</span>
                            √Ä propos
                        </button>
                        <button class="dropdown-item">
                            <span class="material-symbols-rounded">settings</span>
                            Param√®tres
                        </button>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item item-danger">
                            <span class="material-symbols-rounded">logout</span>
                            Se d√©connecter
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="pages-wrapper">
            <main class="page" id="page-accueil">
                <div class="card average-hero" id="average-hero">
                    <div class="average-label">Moyenne G√©n√©rale</div>
                    <div class="average-value" id="average-value">--</div>
                    <div class="average-evolution" id="average-evolution">
                        <span class="material-symbols-rounded">trending_flat</span>
                        <span id="evolution-text">Pas de donn√©es</span>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">
                        <span class="material-symbols-rounded">show_chart</span>
                        √âvolution
                    </h2>
                    <div class="chart-container">
                        <canvas id="evolution-chart"></canvas>
                    </div>
                </div>

                <div class="card target-card">
                    <div class="target-header">
                        <h2 class="section-title" style="margin-bottom: 0;">
                            <span class="material-symbols-rounded">flag</span>
                            Objectif
                        </h2>
                        <div class="target-input-container">
                            <input type="number" class="target-input" id="target-input" min="0" max="20" step="0.01" value="20">
                            <span>/20</span>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="target-progress"></div>
                    </div>
                    <div class="progress-label">
                        <span id="progress-current">0.00</span>
                        <span id="progress-remaining">Il reste 20.00 pts</span>
                    </div>
                </div>

                <div class="topflop-grid">
                    <div class="card topflop-card">
                        <h3 class="topflop-title">
                            <span class="material-symbols-rounded" style="color: #4caf50;">trending_up</span>
                            Top 3
                        </h3>
                        <div id="top-list"></div>
                    </div>
                    <div class="card topflop-card">
                        <h3 class="topflop-title">
                            <span class="material-symbols-rounded" style="color: #f44336;">trending_down</span>
                            Flop 3
                        </h3>
                        <div id="flop-list"></div>
                    </div>
                </div>

                <div class="card export-section">
                    <h2 class="section-title">
                        <span class="material-symbols-rounded">share</span>
                        Partager
                    </h2>
                    <div class="export-buttons">
                        <button class="export-btn" id="share-card-btn">
                            <span class="material-symbols-rounded">image</span>
                            Partage direct
                        </button>
                        <button class="export-btn" id="export-pdf-btn">
                            <span class="material-symbols-rounded">description</span>
                            Bulletin fictif
                        </button>
                    </div>
                </div>
            </main>

            <main class="page hidden" id="page-labo">
                
                <div class="card add-note-card">
                    <h2 class="section-title">
                        <span class="material-symbols-rounded">add_circle</span>
                        Ajouter une note
                    </h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Mati√®re</label>
                            <select class="form-select" id="note-subject">
                                <option value="">S√©lectionner...</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Note</label>
                            <input type="number" class="form-input" id="note-value" placeholder="15" min="0" max="20" step="0.01">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Sur</label>
                            <input type="number" class="form-input" id="note-max" placeholder="20" min="1" max="100" value="20">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Coef</label>
                            <input type="number" class="form-input" id="note-coef" placeholder="1" min="0.1" max="20" step="0.1" value="1">
                        </div>
                    </div>
                    <button class="add-btn" id="add-note-btn">
                        <span class="material-symbols-rounded">add</span>
                        Ajouter la note
                    </button>
                </div>

                <div class="subjects-header">
                    <h2 class="section-title" style="margin-bottom: 0;">
                        <span class="material-symbols-rounded">folder</span>
                        Mes mati√®res
                    </h2>
                    <button class="coef-btn" id="coef-dialog-btn">
                        <span class="material-symbols-rounded">tune</span>
                        Coefficients
                    </button>
                </div>

                <div id="subjects-container"></div>
            </main>
        </div>

        <nav class="bottom-nav">
            <button class="nav-item active" data-page="accueil">
                <div class="nav-pill">
                    <span class="material-symbols-rounded filled">home</span>
                </div>
                <span class="nav-label">Accueil</span>
            </button>
            <button class="nav-item" data-page="labo">
                <div class="nav-pill">
                    <span class="material-symbols-rounded">science</span>
                </div>
                <span class="nav-label">Labo</span>
            </button>
        </nav>
    </div>

    <div class="bottom-sheet-overlay" id="info-sheet">
        <div class="bottom-sheet">
            <div class="bottom-sheet-handle"></div>
            <h2 class="bottom-sheet-title">Connexion √† EcoleDirecte</h2>
            <div class="bottom-sheet-content">
                <p>Bient√¥t disponible ! La connexion √† EcoleDirecte te permettra de :</p>
                <ul>
                    <li>üìö Synchroniser automatiquement tes notes</li>
                </ul>
                <p>On travaille dur pour te proposer cette fonctionnalit√© le plus vite possible !</p>
            </div>
            <button class="bottom-sheet-close" id="close-info-sheet">J'ai compris</button>
        </div>
    </div>

    <div class="dialog-overlay" id="coef-dialog">
        <div class="dialog">
            <h2 class="dialog-title">Coefficients des mati√®res</h2>
            <div id="coef-list"></div>
            <div class="dialog-actions">
                <button class="dialog-btn dialog-btn-secondary" id="close-coef-dialog">Annuler</button>
                <button class="dialog-btn dialog-btn-primary" id="save-coef-dialog">Enregistrer</button>
            </div>
        </div>
    </div>

    <div class="dialog-overlay" id="share-dialog">
        <div class="dialog" style="max-width: 360px;">
            <h2 class="dialog-title">Cr√©er ta carte de partage</h2>
            <div class="share-card-container" id="share-form">
                <div class="share-input-group">
                    <input type="text" class="share-input" id="share-name" placeholder="Ton pr√©nom" maxlength="20">
                </div>
                <p style="font-size: 13px; color: var(--md-sys-color-on-surface-variant); margin-bottom: 8px;">Choisis un emoji</p>
                <div class="emoji-picker" id="emoji-picker"></div>
            </div>
            <div id="share-preview" style="display: none;"></div>
            <div class="dialog-actions">
                <button class="dialog-btn dialog-btn-secondary" id="close-share-dialog">Fermer</button>
                <button class="dialog-btn dialog-btn-primary" id="generate-share-card">G√©n√©rer</button>
            </div>
        </div>
    </div>

    <div class="dialog-overlay" id="edit-dialog">
        <div class="dialog">
            <h2 class="dialog-title">Modifier la note</h2>
            <div class="form-row" style="flex-direction: column; gap: 16px;">
                <div class="form-group">
                    <label class="form-label">Note</label>
                    <input type="number" class="form-input" id="edit-note-value" min="0" max="20" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">Sur</label>
                    <input type="number" class="form-input" id="edit-note-max" min="1" max="100">
                </div>
                <div class="form-group">
                    <label class="form-label">Coefficient</label>
                    <input type="number" class="form-input" id="edit-note-coef" min="0.1" max="20" step="0.1">
                </div>
                <div class="ghost-toggle" style="padding: 0; display: none;">
                    <div class="checkbox-m3" id="edit-ghost-checkbox">
                        <span class="material-symbols-rounded filled">check</span>
                    </div>
                    <label class="ghost-toggle-label">Note fant√¥me (simulation)</label>
                </div>
            </div>
            <div class="dialog-actions">
                <button class="dialog-btn dialog-btn-secondary" id="close-edit-dialog">Annuler</button>
                <button class="dialog-btn dialog-btn-primary" id="save-edit-dialog">Enregistrer</button>
            </div>
        </div>
    </div>

	<div class="dialog-overlay" id="release-notes-dialog">
        <div class="dialog">
            <h2 class="dialog-title">Notes de version (v1.1)</h2>
            <div class="dialog-content" style="max-height: 300px; overflow-y: auto; text-align: left;">
                <p><strong>Nouveaut√©s :</strong></p>
                <ul style="padding-left: 20px; margin-top: 8px;">
                    <li>üë§ Connexion EcoleDirecte : Vous pouvez enfin vous connecter √† EcoleDirecte !</li>
					<li>üìà Le graphique zoome pour ne laisser aucun espace
					<li>üõ†Ô∏è Divers autres fixs</li>
                </ul>
            </div>
            <div class="dialog-actions">
                <button class="dialog-btn dialog-btn-primary" id="close-release-notes">G√©nial !</button>
            </div>
        </div>
    </div>

    <div class="snackbar" id="snackbar"></div>

	<script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(reg => console.log('SW enregistr√© !', reg))
            .catch(err => console.log('Erreur SW...', err));
        });
      }
    </script>
	
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="assets/js/idb.js"></script>
	<script src="assets/js/app.js"></script>
</body>
</html>
